<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Gi√°m s√°t an to√†n th·ª£ m·ªè</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #e8f5e9;
            transition: background-color 0.5s;
        }

        h1 {
            margin-top: 40px;
        }

        #hr {
            font-size: 72px;
            margin: 20px 0;
        }

        #status {
            font-size: 32px;
            margin: 10px 0;
        }

        #message {
            font-size: 20px;
            margin-top: 10px;
        }

        #fall {
            font-size: 26px;
            margin-top: 20px;
        }

        .normal { color: #2e7d32; }
        .danger { color: #c62828; }
        .warning { color: #ef6c00; }

        .bg-normal { background-color: #e8f5e9; }
        .bg-danger { background-color: #ffebee; }
    </style>
</head>
<body class="bg-normal">

    <h1>‚õèÔ∏è Gi√°m s√°t an to√†n th·ª£ m·ªè</h1>

    <!-- HEART RATE -->
    <div id="hr" class="normal">-- bpm</div>
    <div id="status">ƒêang ch·ªù d·ªØ li·ªáu...</div>
    <div id="message"></div>

    <!-- FALL STATUS -->
    <div id="fall" class="normal">üßç ƒêang ch·ªù d·ªØ li·ªáu</div>

    <script>
        async function fetchStatus() {
            try {
                const res = await fetch("/latest_status");
                if (!res.ok) return;

                const data = await res.json();

                const hrDiv = document.getElementById("hr");
                const statusDiv = document.getElementById("status");
                const messageDiv = document.getElementById("message");
                const fallDiv = document.getElementById("fall");
                const body = document.body;

                /* ======================
                   HEART RATE
                ====================== */
                if (data.hr !== null && data.hr !== undefined) {
                    hrDiv.textContent = data.hr + " bpm";
                    messageDiv.textContent = data.hr_message || "";

                    if (data.hr_danger) {
                        hrDiv.className = "danger";
                    } else {
                        hrDiv.className = "normal";
                    }
                } else {
                    hrDiv.textContent = "-- bpm";
                }
                // if (data.hr !== null) {
                //     hrDiv.textContent = data.hr + " bpm (TB 5s)";
                //     messageDiv.textContent = data.hr_message || "";

                //     if (data.hr_danger) {
                //         hrDiv.className = "danger";
                //     } else {
                //         hrDiv.className = "normal";
                //     }
                // }


                /* ======================
                   FALL
                ====================== */
                if (data.fall_status === "FALL") {
                    fallDiv.textContent = `‚ö†Ô∏è PH√ÅT HI·ªÜN NG√É (p=${data.fall_prob.toFixed(2)})`;
                    fallDiv.className = "danger";
                }
                else if (data.fall_status === "RECOVERED") {
                    fallDiv.textContent = "üßç ƒê√£ ƒë·ª©ng d·∫≠y";
                    fallDiv.className = "warning";
                }
                else if (data.fall_status === "SAFE") {
                    fallDiv.textContent = "üßç An to√†n";
                    fallDiv.className = "normal";
                }
                else {
                    fallDiv.textContent = "‚è≥ ƒêang ch·ªù d·ªØ li·ªáu";
                    fallDiv.className = "normal";
                }

                /* ======================
                   GLOBAL ALERT
                   FALL > HR
                ====================== */
                if (data.fall_status === "FALL") {
                    statusDiv.textContent = "üö® NGUY HI·ªÇM ‚Äì PH√ÅT HI·ªÜN NG√É";
                    statusDiv.className = "danger";
                    body.className = "bg-danger";
                }
                else if (data.hr_danger) {
                    statusDiv.textContent = "‚ö†Ô∏è Nh·ªãp tim b·∫•t th∆∞·ªùng";
                    statusDiv.className = "warning";
                    body.className = "bg-danger";
                }
                else {
                    statusDiv.textContent = "B√¨nh th∆∞·ªùng";
                    statusDiv.className = "normal";
                    body.className = "bg-normal";
                }

            } catch (e) {
                console.error("Fetch error:", e);
            }
        }

        // c·∫≠p nh·∫≠t m·ªói 1 gi√¢y
        setInterval(fetchStatus, 1000);
    </script>

</body>
</html>
